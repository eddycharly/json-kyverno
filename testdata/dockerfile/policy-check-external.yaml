apiVersion: json.kyverno.io/v1alpha1
kind: Policy
metadata:
  name: check-dockerfile
spec:
  rules:
    - name: no-external
      validate:
        assert:
          all:
          - message: "HTTP calls are not allowed"
            check:
              ~.(Stages[].Commands[].Args[].Value):
                (contains(@, 'https://') || contains(@, 'http://')): false
          - message: "curl / wget are not allowed"
            check:
              ~.(Stages[].Commands[].CmdLine[]):
                (contains(@, 'wget') || contains(@, 'curl')): false